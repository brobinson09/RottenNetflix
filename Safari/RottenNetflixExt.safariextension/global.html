<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>

	function getRottenRating(msgEvent){	
		$.ajax({
			url: msgEvent.message['movieUrl'],
			dataType: 'html',
			success:function(data){
				
				var rating = $('#all-critics-meter', data).html();
				
				var returnObject = {
					index: msgEvent.message['index'],
					rating: rating
				}
				
				safari.application.activeBrowserWindow.activeTab.page.dispatchMessage("returnRating", returnObject);

			}
		});
	}


	
	safari.application.addEventListener("message",getRottenRating,false);

	
</script>